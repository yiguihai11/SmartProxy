<!DOCTYPE html>
<html>
<head>
    <title>Debug Memory</title>
</head>
<body>
    <h1>Debug Memory Monitor</h1>
    <div id="debug"></div>

    <script>
        let debugDiv = document.getElementById('debug');

        // 测试加载函数
        async function debugLoadData() {
            debugDiv.innerHTML += '<p>Starting loadData...</p>';

            try {
                // 测试 pools API
                debugDiv.innerHTML += '<p>Fetching pools API...</p>';
                const poolsResponse = await fetch('/api/memory/pools');
                debugDiv.innerHTML += '<p>Pools response status: ' + poolsResponse.status + '</p>';

                if (!poolsResponse.ok) {
                    throw new Error('Pools API failed: ' + poolsResponse.statusText);
                }

                const poolsData = await poolsResponse.json();
                debugDiv.innerHTML += '<p>Pools data received</p>';
                console.log('Pools data:', poolsData);

                // 检查数据结构
                if (poolsData.success && poolsData.data) {
                    if (poolsData.data.buffer_pool && poolsData.data.connection_pool) {
                        debugDiv.innerHTML += '<p>✓ Data structure is correct</p>';
                    } else {
                        debugDiv.innerHTML += '<p>✗ Data structure is incorrect</p>';
                    }
                } else {
                    debugDiv.innerHTML += '<p>✗ Success flag missing</p>';
                }

                debugDiv.innerHTML += '<p>✓ loadData completed successfully!</p>';

            } catch (error) {
                debugDiv.innerHTML += '<p style="color: red;">Error: ' + error.message + '</p>';
                console.error('Debug error:', error);
            }
        }

        // 执行测试
        debugLoadData();
    </script>
</body>
</html>