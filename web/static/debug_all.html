<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartProxy ç»¼åˆè°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header h1 {
            margin: 0 0 10px 0;
            color: #2d3748;
        }
        .header p {
            margin: 0;
            color: #718096;
        }
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn.refresh {
            background: #28a745;
        }
        .btn.refresh:hover {
            background: #1e7e34;
        }
        .btn.clear {
            background: #dc3545;
        }
        .btn.clear:hover {
            background: #c82333;
        }
        .endpoint-group {
            background: white;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .endpoint-header {
            background: #667eea;
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .endpoint-header:hover {
            background: #5a67d8;
        }
        .endpoint-header span {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .endpoint-content {
            padding: 20px;
            display: none;
        }
        .endpoint-content.active {
            display: block;
        }
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            overflow-x: auto;
            border-radius: 5px;
            font-size: 14px;
            line-height: 1.5;
        }
        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success {
            background: #c6f6d5;
            color: #22543d;
        }
        .status.error {
            background: #fed7d7;
            color: #c53030;
        }
        .timestamp {
            font-size: 12px;
            color: #718096;
            margin-top: 10px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ” SmartProxy ç»¼åˆè°ƒè¯•é¡µé¢</h1>
        <p>å®æ—¶æŸ¥çœ‹æ‰€æœ‰ API ç«¯ç‚¹çš„å“åº”æ•°æ®ï¼Œç”¨äºè°ƒè¯•å’Œç›‘æ§</p>
    </div>

    <div class="controls">
        <button class="btn refresh" onclick="loadAllData()">ğŸ”„ åˆ·æ–°æ‰€æœ‰æ•°æ®</button>
        <button class="btn" onclick="toggleAutoRefresh()">â±ï¸ è‡ªåŠ¨åˆ·æ–° (å…³é—­)</button>
        <button class="btn" onclick="expandAll()">ğŸ“‚ å±•å¼€æ‰€æœ‰</button>
        <button class="btn" onclick="collapseAll()">ğŸ“ æŠ˜å æ‰€æœ‰</button>
        <button class="btn clear" onclick="clearData()">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>
    </div>

    <div id="output"></div>

    <script>
        let autoRefreshInterval = null;
        let isAutoRefreshOn = false;

        // API ç«¯ç‚¹åˆ—è¡¨
        const endpoints = [
            // ç³»ç»ŸçŠ¶æ€
            {
                path: '/api/health',
                name: 'å¥åº·æ£€æŸ¥',
                group: 'ç³»ç»ŸçŠ¶æ€',
                description: 'æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ'
            },
            {
                path: '/api/status',
                name: 'æœåŠ¡å™¨çŠ¶æ€',
                group: 'ç³»ç»ŸçŠ¶æ€',
                description: 'æœåŠ¡å™¨è¿è¡Œæ—¶é—´å’ŒçŠ¶æ€ä¿¡æ¯'
            },
            {
                path: '/api/stats',
                name: 'ç»Ÿè®¡ä¿¡æ¯',
                group: 'ç³»ç»ŸçŠ¶æ€',
                description: 'æ´»è·ƒè¿æ¥ã€è¯·æ±‚ç»Ÿè®¡ç­‰'
            },
            {
                path: '/api/blacklist',
                name: 'é»‘åå•ç»Ÿè®¡',
                group: 'ç³»ç»ŸçŠ¶æ€',
                description: 'è¢«å±è”½çš„åŸŸåå’ŒIPç»Ÿè®¡'
            },
            {
                path: '/api/blacklist/list',
                name: 'é»‘åå•åˆ—è¡¨',
                group: 'ç³»ç»ŸçŠ¶æ€',
                description: 'è¯¦ç»†çš„é»‘åå•é¡¹åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰'
            },

            // æµé‡ç»Ÿè®¡
            {
                path: '/api/traffic/stats',
                name: 'æµé‡ç»Ÿè®¡',
                group: 'æµé‡ç»Ÿè®¡',
                description: 'æ€»ä¸Šä¼ /ä¸‹è½½æµé‡ã€æ´»è·ƒè¿æ¥æ•°'
            },

            // å†…å­˜ç›‘æ§
            {
                path: '/api/memory/stats',
                name: 'å†…å­˜åŸºç¡€ç»Ÿè®¡',
                group: 'å†…å­˜ç›‘æ§',
                description: 'å·²åˆ†é…å†…å­˜ã€GCæ¬¡æ•°ç­‰'
            },
            {
                path: '/api/memory/usage',
                name: 'å†…å­˜ä½¿ç”¨è¯¦æƒ…',
                group: 'å†…å­˜ç›‘æ§',
                description: 'ç³»ç»Ÿå†…å­˜ä½¿ç”¨æƒ…å†µ'
            },
            {
                path: '/api/memory/efficiency',
                name: 'å†…å­˜æ•ˆç‡åˆ†æ',
                group: 'å†…å­˜ç›‘æ§',
                description: 'å†…å­˜å‹åŠ›å’Œæ± æ•ˆç‡'
            },
            {
                path: '/api/memory/pools',
                name: 'å¯¹è±¡æ± ç»Ÿè®¡',
                group: 'å†…å­˜ç›‘æ§',
                description: 'ç¼“å†²åŒºæ± å’Œè¿æ¥æ± è¯¦ç»†ä¿¡æ¯'
            },

            // é…ç½®ç®¡ç†
            {
                path: '/api/config',
                name: 'ç³»ç»Ÿé…ç½®',
                group: 'é…ç½®ç®¡ç†',
                description: 'ä»£ç†ã€è·¯ç”±ç­‰é…ç½®ä¿¡æ¯',
                method: 'GET'
            },

            // ç”¨æˆ·å’Œä»£ç†èŠ‚ç‚¹
            {
                path: '/api/users',
                name: 'ç”¨æˆ·åˆ—è¡¨',
                group: 'ç”¨æˆ·ç®¡ç†',
                description: 'SOCKS5è®¤è¯ç”¨æˆ·åˆ—è¡¨'
            },
            {
                path: '/api/proxy-nodes',
                name: 'ä»£ç†èŠ‚ç‚¹',
                group: 'ä»£ç†èŠ‚ç‚¹',
                description: 'å¯ç”¨çš„ä»£ç†èŠ‚ç‚¹é…ç½®'
            },
            {
                path: '/api/rules',
                name: 'è·¯ç”±è§„åˆ™',
                group: 'è·¯ç”±è§„åˆ™',
                description: 'æ™ºèƒ½è·¯ç”±è§„åˆ™é…ç½®'
            }
        ];

        // æŒ‰ç»„åˆ†ç±»ç«¯ç‚¹
        const groupedEndpoints = endpoints.reduce((acc, endpoint) => {
            if (!acc[endpoint.group]) {
                acc[endpoint.group] = [];
            }
            acc[endpoint.group].push(endpoint);
            return acc;
        }, {});

        // æ¸²æŸ“é¡µé¢
        function renderPage() {
            const output = document.getElementById('output');
            let html = '';

            for (const [groupName, groupEndpoints] of Object.entries(groupedEndpoints)) {
                html += `
                    <div class="endpoint-group">
                        <div class="endpoint-header" onclick="toggleGroup('${groupName}')">
                            <span>${groupName} (${groupEndpoints.length})</span>
                            <span>â–¼</span>
                        </div>
                        <div class="endpoint-content active" id="group-${groupName}">
                `;

                for (const endpoint of groupEndpoints) {
                    html += `
                        <h4 style="margin-bottom: 5px; color: #4a5568;">
                            <a href="#" onclick="toggleEndpoint('${endpoint.path}')" style="text-decoration: none; color: inherit;">
                                ${endpoint.name}
                            </a>
                            <span class="status" id="status-${endpoint.path}">â³</span>
                        </h4>
                        <p style="color: #718096; margin: 5px 0 10px 0;">
                            <strong>è·¯å¾„:</strong> <code>${endpoint.path}</code> |
                            <strong>æè¿°:</strong> ${endpoint.description}
                        </p>
                        <div id="content-${endpoint.path}"></div>
                    `;
                }

                html += `
                        </div>
                    </div>
                `;
            }

            output.innerHTML = html;
        }

        // åŠ è½½å•ä¸ªç«¯ç‚¹æ•°æ®
        async function loadEndpoint(endpoint) {
            const statusEl = document.getElementById(`status-${endpoint.path}`);
            const contentEl = document.getElementById(`content-${endpoint.path}`);

            statusEl.textContent = 'ğŸ”„';
            statusEl.className = 'status';

            try {
                const startTime = Date.now();
                const response = await fetch(endpoint.path);
                const responseTime = Date.now() - startTime;

                const data = await response.json();

                statusEl.textContent = 'âœ“';
                statusEl.className = 'status success';

                let content = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <span><strong>å“åº”æ—¶é—´:</strong> ${responseTime}ms</span>
                        <span><strong>çŠ¶æ€ç :</strong> ${response.status}</span>
                        <span><strong>æ—¶é—´æˆ³:</strong> ${new Date().toLocaleString()}</span>
                    </div>
                `;

                if (data.success) {
                    content += `
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;

                    // ç‰¹æ®Šå¤„ç†æŸäº›æ•°æ®
                    if (endpoint.path === '/api/traffic/stats') {
                        content += `
                            <div style="margin-top: 10px; padding: 10px; background: #e6fffa; border-radius: 5px;">
                                <strong>ğŸ“Š æµé‡æ‘˜è¦:</strong><br>
                                æ€»ä¸Šä¼ : ${((data.data.total_upload || 0) / 1024 / 1024).toFixed(2)} MB<br>
                                æ€»ä¸‹è½½: ${((data.data.total_download || 0) / 1024 / 1024).toFixed(2)} MB<br>
                                æ´»è·ƒè¿æ¥: ${data.data.active_connections || 0}
                            </div>
                        `;
                    } else if (endpoint.path === '/api/memory/pools') {
                        content += `
                            <div style="margin-top: 10px; padding: 10px; background: #f0fff4; border-radius: 5px;">
                                <strong>ğŸ’¾ å¯¹è±¡æ± æ‘˜è¦:</strong><br>
                                ç¼“å†²åŒºæ± å‘½ä¸­ç‡: ${(data.data.buffer_pool?.hit_rate_percent || 0).toFixed(1)}%<br>
                                è¿æ¥æ± å‘½ä¸­ç‡: ${(data.data.connection_pool?.hit_rate_percent || 0).toFixed(1)}%
                            </div>
                        `;
                    }
                } else {
                    content += `<div class="error">âŒ é”™è¯¯: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }

                contentEl.innerHTML = content;

            } catch (error) {
                statusEl.textContent = 'âœ—';
                statusEl.className = 'status error';

                contentEl.innerHTML = `
                    <div class="error">
                        <strong>è¯·æ±‚å¤±è´¥:</strong> ${error.message}<br>
                        <strong>æ—¶é—´æˆ³:</strong> ${new Date().toLocaleString()}
                    </div>
                `;
            }
        }

        // åŠ è½½æ‰€æœ‰æ•°æ®
        async function loadAllData() {
            console.log('å¼€å§‹åŠ è½½æ‰€æœ‰APIæ•°æ®...');

            // å¹¶è¡ŒåŠ è½½æ‰€æœ‰ç«¯ç‚¹
            const promises = endpoints.map(endpoint => loadEndpoint(endpoint));
            await Promise.all(promises);

            console.log('æ‰€æœ‰APIæ•°æ®åŠ è½½å®Œæˆ');
        }

        // åˆ‡æ¢è‡ªåŠ¨åˆ·æ–°
        function toggleAutoRefresh() {
            const btn = event.target;
            isAutoRefreshOn = !isAutoRefreshOn;

            if (isAutoRefreshOn) {
                btn.textContent = 'â±ï¸ è‡ªåŠ¨åˆ·æ–° (å¼€å¯)';
                btn.style.background = '#ffc107';
                btn.style.color = '#000';

                autoRefreshInterval = setInterval(() => {
                    loadAllData();
                }, 5000); // æ¯5ç§’åˆ·æ–°ä¸€æ¬¡
            } else {
                btn.textContent = 'â±ï¸ è‡ªåŠ¨åˆ·æ–° (å…³é—­)';
                btn.style.background = '#007bff';
                btn.style.color = '#fff';

                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
            }
        }

        // åˆ‡æ¢ç»„å±•å¼€/æŠ˜å 
        function toggleGroup(groupName) {
            const content = document.getElementById(`group-${groupName}`);
            content.classList.toggle('active');
        }

        // å±•å¼€æ‰€æœ‰ç»„
        function expandAll() {
            document.querySelectorAll('.endpoint-content').forEach(el => {
                el.classList.add('active');
            });
        }

        // æŠ˜å æ‰€æœ‰ç»„
        function collapseAll() {
            document.querySelectorAll('.endpoint-content').forEach(el => {
                el.classList.remove('active');
            });
        }

        // æ¸…ç©ºæ•°æ®
        function clearData() {
            endpoints.forEach(endpoint => {
                const contentEl = document.getElementById(`content-${endpoint.path}`);
                const statusEl = document.getElementById(`status-${endpoint.path}`);

                if (contentEl) contentEl.innerHTML = '<em style="color: #999;">æ•°æ®å·²æ¸…ç©º</em>';
                if (statusEl) {
                    statusEl.textContent = '?';
                    statusEl.className = 'status';
                }
            });
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            renderPage();
            // è‡ªåŠ¨åŠ è½½ä¸€æ¬¡æ•°æ®
            loadAllData();
        };
    </script>
</body>
</html>