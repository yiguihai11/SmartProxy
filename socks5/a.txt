       1138 -  // isGFWDetected ä¼ è¾“å±‚ç³»ç»Ÿé”™è¯¯ç æ£€æµ‹ + åº”ç”¨å±‚å­—ç¬¦ä¸²æ£€æµ‹
       1139 -  func (c *Connection) isGFWDetected(err error) bool {
       1140 -    if err == nil {
       1141 -      return false
       1142 -    }
       1143 -
       1144 -    // ä¼˜å…ˆä½¿ç”¨ä¼ è¾“å±‚ç³»ç»Ÿé”™è¯¯ç æ£€æµ‹ï¼ˆæ›´å‡†ç¡®ï¼‰
       1145 -    if opErr, ok := err.(*net.OpError); ok {
       1146 -      if sysErr, ok := opErr.Err.(*os.SyscallError); ok {
       1147 -        if errno, ok := sysErr.Err.(syscall.Errno); ok {
       1148 -          // ç³»ç»Ÿé”™è¯¯ç  104 = ECONNRESET = GFWé‡ç½®
       1149 -          if errno == syscall.ECONNRESET {
       1150 -            c.logger.Printf("GFW reset detected by system error code: ECONNRESET(104)")
       1151 -            return true
       1152 -          }
       1153 -          // ç³»ç»Ÿé”™è¯¯ç  32 = EPIPE = ä¹Ÿæ˜¯GFWé‡ç½®çš„å¸¸è§æ¨¡å¼
       1154 -          if errno == syscall.EPIPE {
       1155 -            c.logger.Printf("GFW reset detected by system error code: EPIPE(32)")
       1156 -            return true
       1157 -          }
       1158 -        }
       1159 -      }
       1160 -    }
       1161 -
       1162 -    // ä½œä¸ºfallbackï¼Œä½¿ç”¨åº”ç”¨å±‚å­—ç¬¦ä¸²åŒ¹é…
       1163 -    if strings.Contains(err.Error(), "connection reset by peer") {
       1164 -      c.logger.Printf("GFW reset detected by string matching")
       1165 -      return true
       1166 -    }
       1167 -
       1168 -    return false
       1169 -  }
       
       
       
       
       â€‹é˜²æ­¢ Socket æ³„éœ² (å…³é”®):





â€‹å½“ç¬¬ä¸€ä¸ªè¿æ¥æˆåŠŸå¹¶ return åï¼Œæˆ‘å¯åŠ¨äº†ä¸€ä¸ªåŒ¿å Goroutine (go func() { ... })ã€‚



â€‹å®ƒçš„ä»»åŠ¡æ˜¯ç­‰å¾…é‚£ä¸ªâ€œæ¯”è¾ƒæ…¢â€çš„ç»“æœã€‚å¦‚æœé‚£ä¸ªæ…¢çš„ç»“æœä¹Ÿè¿æ¥æˆåŠŸäº†ï¼Œå®ƒä¼šç«‹å³è°ƒç”¨ .Close()ã€‚



â€‹å¦‚æœæ²¡æœ‰è¿™ä¸ªæœºåˆ¶ï¼Œæ…¢çš„é‚£ä¸ªè¿æ¥ä¼šä¸€ç›´æŒ‚åœ¨åå°ï¼Œç›´åˆ° TCP è¶…æ—¶ï¼Œè¿™åœ¨é«˜å¹¶å‘ä¸‹ä¼šè€—å°½æœåŠ¡å™¨çš„å¥æŸ„ã€‚



â€‹ç¼“å†²é€šé“ (Buffered Channel):





â€‹ä½¿ç”¨ results := make(chan connResult, 2)ã€‚



â€‹å³ä½¿ä¸»å‡½æ•°å› ä¸ºè¶…æ—¶æˆ–è€…ç¬¬ä¸€ä¸ªç»“æœå·²ç»è¿”å›è€Œé€€å‡ºäº†ï¼Œåå°çš„ Goroutine ä¾ç„¶å¯ä»¥æŠŠç»“æœå†™è¿›å»ç„¶åæ­£å¸¸é€€å‡ºï¼Œä¸ä¼šè¢«æ°¸ä¹…é˜»å¡ï¼ˆGoroutine Leakï¼‰ã€‚

ğŸ” æ½œåœ¨æ”¹è¿›æ–¹å‘  æ€§èƒ½ä¼˜åŒ–  ä½¿ç”¨ io.Copy æ›¿ä»£æ‰‹åŠ¨å¾ªç¯ï¼ˆrelay å‡½æ•°ï¼‰ é›¶æ‹·è´æŠ€æœ¯ï¼ˆsplice ç³»ç»Ÿè°ƒç”¨ï¼‰

UDP è½¬å‘ï¼ˆSOCKS5 UDP ASSOCIATEï¼‰



